{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Enhanced CV Data Schema for RAG System",
  "description": "Optimized schema for SmolLM2-135M-Instruct and Xenova/distilbert-base-uncased embedding model",
  "type": "object",
  "required": ["metadata", "sections", "personality", "responseTemplates"],
  "properties": {
    "metadata": {
      "type": "object",
      "required": ["version", "lastUpdated", "totalSections", "embeddingModel", "embeddingDimensions"],
      "properties": {
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+$",
          "description": "Schema version"
        },
        "lastUpdated": {
          "type": "string",
          "format": "date",
          "description": "Last update date in YYYY-MM-DD format"
        },
        "totalSections": {
          "type": "integer",
          "minimum": 1,
          "description": "Total number of CV sections for validation"
        },
        "embeddingModel": {
          "type": "string",
          "description": "Model used for generating embeddings (e.g., Xenova/distilbert-base-uncased)"
        },
        "embeddingDimensions": {
          "type": "integer",
          "minimum": 1,
          "description": "Embedding vector dimensions (768 for distilbert-base-uncased)"
        }
      }
    },
    "sections": {
      "type": "object",
      "description": "Hierarchically organized CV sections for optimal retrieval",
      "properties": {
        "core": {
          "type": "object",
          "description": "Essential identity and contact information",
          "patternProperties": {
            "^[a-zA-Z_]+$": {
              "$ref": "#/definitions/cvSection"
            }
          }
        },
        "experience": {
          "type": "object", 
          "description": "Work history organized by company and role",
          "patternProperties": {
            "^[a-zA-Z_]+$": {
              "$ref": "#/definitions/cvSection"
            }
          }
        },
        "skills": {
          "type": "object",
          "description": "Technical capabilities grouped by domain",
          "patternProperties": {
            "^[a-zA-Z_]+$": {
              "$ref": "#/definitions/cvSection"
            }
          }
        },
        "themes": {
          "type": "object",
          "description": "Cross-cutting concepts like management style, problem-solving approach",
          "patternProperties": {
            "^[a-zA-Z_]+$": {
              "$ref": "#/definitions/cvSection"
            }
          }
        },
        "personal": {
          "type": "object",
          "description": "Interests, hobbies, and personality traits",
          "patternProperties": {
            "^[a-zA-Z_]+$": {
              "$ref": "#/definitions/cvSection"
            }
          }
        }
      }
    },
    "personality": {
      "type": "object",
      "required": ["traits", "values", "workStyle", "interests", "communication_style"],
      "properties": {
        "traits": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "description": "Core personality traits"
        },
        "values": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "description": "Professional and personal values"
        },
        "workStyle": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "description": "Preferred working approaches"
        },
        "interests": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "description": "Personal and professional interests"
        },
        "communication_style": {
          "type": "object",
          "required": ["hr", "developer", "friend"],
          "properties": {
            "hr": {
              "$ref": "#/definitions/communicationStyle"
            },
            "developer": {
              "$ref": "#/definitions/communicationStyle"
            },
            "friend": {
              "$ref": "#/definitions/communicationStyle"
            }
          }
        }
      }
    },
    "responseTemplates": {
      "type": "object",
      "required": ["noMatch", "lowConfidence", "fallbackRequest", "emailFallback"],
      "properties": {
        "noMatch": {
          "$ref": "#/definitions/styleResponses"
        },
        "lowConfidence": {
          "$ref": "#/definitions/styleResponses"
        },
        "fallbackRequest": {
          "$ref": "#/definitions/styleResponses"
        },
        "emailFallback": {
          "$ref": "#/definitions/styleResponses"
        }
      }
    }
  },
  "definitions": {
    "cvSection": {
      "type": "object",
      "required": ["id", "keywords", "embeddingSourceText", "embeddings", "responses", "details"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9_]+$",
          "description": "Unique identifier for this section"
        },
        "keywords": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 3,
          "maxItems": 15,
          "description": "Primary keywords for semantic matching. Include exact terms, related concepts, and use cases."
        },
        "embeddingSourceText": {
          "type": "string",
          "minLength": 50,
          "maxLength": 500,
          "description": "Dense, keyword-rich text optimized for embedding generation. This is the 'document' that gets embedded for retrieval."
        },
        "embeddings": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "type": "array",
              "items": {
                "type": "number"
              },
              "minItems": 768,
              "maxItems": 768
            }
          ],
          "description": "768-dimensional embedding vector (null until generated)"
        },
        "responses": {
          "$ref": "#/definitions/styleResponses",
          "description": "Pre-written responses for each communication style. Used as few-shot examples for SmolLM."
        },
        "details": {
          "type": "object",
          "description": "Structured data for this section (flexible schema based on content type)"
        },
        "relatedSections": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "IDs of related sections to include for richer context",
          "default": []
        },
        "priority": {
          "type": "integer",
          "minimum": 1,
          "maximum": 5,
          "default": 3,
          "description": "Retrieval priority (1=highest, 5=lowest)"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 1.0,
          "description": "Confidence score for section completeness and accuracy"
        }
      }
    },
    "styleResponses": {
      "type": "object",
      "required": ["hr", "developer", "friend"],
      "properties": {
        "hr": {
          "type": "string",
          "minLength": 20,
          "maxLength": 300,
          "description": "Professional, achievement-focused response for HR/recruiters"
        },
        "developer": {
          "type": "string", 
          "minLength": 20,
          "maxLength": 300,
          "description": "Technical, detailed response for fellow developers"
        },
        "friend": {
          "type": "string",
          "minLength": 20,
          "maxLength": 300,
          "description": "Casual, enthusiastic response for informal conversations"
        }
      }
    },
    "communicationStyle": {
      "type": "object",
      "required": ["tone", "language", "focus", "greeting"],
      "properties": {
        "tone": {
          "type": "string",
          "description": "Overall communication tone for this persona"
        },
        "language": {
          "type": "string",
          "description": "Language style and formality level"
        },
        "focus": {
          "type": "string",
          "description": "What this persona cares about most"
        },
        "greeting": {
          "type": "string",
          "minLength": 20,
          "maxLength": 200,
          "description": "Standard greeting for this persona"
        }
      }
    }
  }
}